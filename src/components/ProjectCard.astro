---
import { slugifyStr } from "@/utils/slugify";
import { getTagHue, getIcon } from "@/utils/projectUtils";
import ProjectDialog from "./ProjectDialog.astro";

type Props = {
  project: {
    project_name: string;
    short_desc: string;
    full_desc?: string;
    tags: {
      icon: { name: string; iconName: string }[];
      noIcon: string[];
    };
    github_url: string;
    time_period: string;
    photos?: string[];
  };
  variant?: "h2" | "h3";
};

const { variant: Heading = "h2", project } = Astro.props;
const { project_name, short_desc, tags } = project;

const projectId = slugifyStr(project_name);
const dialogId = `dialog-${projectId}`;
---

<li class="mb-5 break-inside-avoid">
  <button
    onclick={`document.getElementById('${dialogId}').showModal()`}
    class="group relative mx-0 flex w-full cursor-pointer flex-col rounded-xl border border-border/60 bg-muted/10 p-5 text-left transition-all duration-200 ease-out hover:-translate-y-0.5 hover:border-accent hover:bg-muted/20 hover:shadow-[0_0_0_1px_var(--accent)] focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-background focus-visible:outline-none"
  >
    <Heading
      class="text-lg font-semibold text-accent decoration-dashed underline-offset-4 group-hover:underline"
      style={{ viewTransitionName: projectId }}
    >
      {project_name}
    </Heading>

    <div
      class="mt-3 flex flex-wrap items-center gap-2 text-foreground/60 group-hover:text-foreground/80"
    >
      {
        tags.icon.map(t => {
          const IconImg = getIcon(t.iconName);
          return (
            <span
              class="flex items-center justify-center p-1 transition-all hover:scale-110"
              title={t.name}
            >
              {IconImg && (
                <span class="icon-container block size-6" set:html={IconImg} />
              )}
            </span>
          );
        })
      }
      {
        tags.noIcon.map(tag => (
          <span
            class="project-tag rounded-md px-2 py-1 text-sm font-medium"
            style={`--tag-hue: ${getTagHue(tag)}`}
          >
            {tag}
          </span>
        ))
      }
    </div>

    <p class="mt-2 line-clamp-3 text-sm text-foreground/85">
      {short_desc}
    </p>

    <span
      class="mt-auto pt-4 text-sm text-foreground/60 group-hover:text-foreground/80"
    >
      View details â†’
    </span>
  </button>

  <ProjectDialog project={project} />
</li>
